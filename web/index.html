<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Postulaciones Staff ‚Äì MineBack</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --red: #e63946;
    --red-dark: #9b1c1c;
    --red-glow: rgba(230, 57, 70, 0.4);
    --bg: #0a0a0a;
    --bg2: #111111;
    --bg3: #181818;
    --border: rgba(230, 57, 70, 0.2);
    --text: #f0f0f0;
    --muted: #888;
    --discord: #5865F2;
    --discord-hover: #4752C4;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(230,57,70,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(230,57,70,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }
  body::after {
    content: '';
    position: fixed;
    top: -20%;
    left: 50%;
    transform: translateX(-50%);
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(230,57,70,0.12) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  /* ‚îÄ‚îÄ PANTALLA DE LOGIN ‚îÄ‚îÄ */
  #login-screen {
    position: fixed;
    inset: 0;
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg);
  }
  #login-screen::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(230,57,70,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(230,57,70,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }
  .login-card {
    position: relative;
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 2.8rem 2.5rem;
    text-align: center;
    max-width: 340px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6), 0 0 40px var(--red-glow);
    animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
  }
  @keyframes popIn {
    from { opacity: 0; transform: scale(0.85) translateY(20px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }
  .login-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    border-radius: 16px 16px 0 0;
    background: linear-gradient(90deg, transparent, var(--red), transparent);
  }
  .login-icon {
    width: 72px;
    height: 72px;
    background: var(--red);
    border-radius: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
    font-size: 2rem;
    box-shadow: 0 8px 24px var(--red-glow);
  }
  .login-card h2 {
    font-family: 'Orbitron', monospace;
    font-size: 1.3rem;
    font-weight: 900;
    letter-spacing: 1px;
    margin-bottom: 0.4rem;
    color: var(--text);
  }
  .login-card h2 span { color: var(--red); }
  .login-card p {
    color: var(--muted);
    font-size: 0.95rem;
    font-weight: 300;
    line-height: 1.5;
    margin-bottom: 2rem;
  }
  .btn-discord {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
    width: 100%;
    background: var(--discord);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 0.9rem 1.5rem;
    font-family: 'Rajdhani', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 1px;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
  }
  .btn-discord:hover {
    background: var(--discord-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(88,101,242,0.4);
  }
  .btn-discord:active { transform: translateY(0); }
  .btn-discord svg { width: 20px; height: 20px; fill: white; flex-shrink: 0; }

  /* ‚îÄ‚îÄ CONTENIDO PRINCIPAL (oculto hasta login) ‚îÄ‚îÄ */
  #main-content { display: none; }

  nav {
    position: sticky; top: 0; z-index: 100;
    background: rgba(10,10,10,0.9);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem; height: 60px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .nav-logo { font-family: 'Orbitron', monospace; font-weight: 900; font-size: 1.1rem; color: var(--red); letter-spacing: 2px; }
  .nav-logo span { color: var(--text); }
  .nav-right { display: flex; align-items: center; gap: 1rem; }
  .nav-breadcrumb { font-size: 0.85rem; color: var(--muted); letter-spacing: 1px; }
  .nav-breadcrumb a { color: var(--red); text-decoration: none; }
  .nav-user {
    display: flex; align-items: center; gap: 0.6rem;
    font-size: 0.9rem; font-weight: 600; color: var(--text);
  }
  .nav-avatar {
    width: 30px; height: 30px; border-radius: 50%;
    border: 2px solid var(--red); object-fit: cover;
  }
  .nav-avatar-placeholder {
    width: 30px; height: 30px; border-radius: 50%;
    background: var(--red); display: flex; align-items: center;
    justify-content: center; font-size: 0.75rem; font-weight: 700; color: #fff;
    border: 2px solid var(--red-dark);
  }
  .btn-logout {
    font-size: 0.75rem; color: var(--muted); background: none;
    border: 1px solid rgba(255,255,255,0.1); border-radius: 4px;
    padding: 3px 8px; cursor: pointer; font-family: 'Rajdhani', sans-serif;
    transition: color 0.2s, border-color 0.2s;
  }
  .btn-logout:hover { color: var(--red); border-color: var(--red); }

  main { position: relative; z-index: 1; max-width: 820px; margin: 0 auto; padding: 3rem 1.5rem 5rem; }
  .hero { text-align: center; margin-bottom: 3rem; animation: fadeDown 0.6s ease both; }
  @keyframes fadeDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .hero-badge {
    display: inline-block;
    background: var(--red-dark); border: 1px solid var(--red); color: var(--red);
    font-family: 'Orbitron', monospace; font-size: 0.65rem; letter-spacing: 3px;
    padding: 4px 14px; border-radius: 2px; margin-bottom: 1.2rem; text-transform: uppercase;
  }
  .hero h1 { font-family: 'Orbitron', monospace; font-size: clamp(1.8rem, 5vw, 3rem); font-weight: 900; line-height: 1.1; margin-bottom: 1rem; }
  .hero h1 span { color: var(--red); }
  .hero-sub { color: var(--muted); font-size: 1.05rem; font-weight: 300; max-width: 560px; margin: 0 auto; line-height: 1.6; }
  .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2.5rem; animation: fadeUp 0.6s 0.1s ease both; }
  .info-card { background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; padding: 1.4rem; position: relative; overflow: hidden; }
  .info-card::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: var(--red); }
  .info-card h3 { font-family: 'Orbitron', monospace; font-size: 0.7rem; letter-spacing: 2px; color: var(--red); text-transform: uppercase; margin-bottom: 0.8rem; }
  .info-card ul { list-style: none; color: #ccc; font-size: 0.95rem; line-height: 1.8; font-weight: 300; }
  .info-card ul li::before { content: '‚ñ∏ '; color: var(--red); }
  .divider { display: flex; align-items: center; gap: 1rem; margin: 2.5rem 0; animation: fadeUp 0.6s 0.15s ease both; }
  .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }
  .divider span { font-family: 'Orbitron', monospace; font-size: 0.65rem; letter-spacing: 3px; color: var(--red); text-transform: uppercase; white-space: nowrap; }
  .form-card { background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; padding: 2.5rem; animation: fadeUp 0.6s 0.2s ease both; position: relative; overflow: hidden; }
  .form-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--red), transparent); }
  .form-header { margin-bottom: 2rem; }
  .form-header h2 { font-family: 'Orbitron', monospace; font-size: 1rem; font-weight: 700; letter-spacing: 2px; margin-bottom: 0.4rem; }
  .form-header p { color: var(--muted); font-size: 0.9rem; font-weight: 300; }
  .field-group { margin-bottom: 1.6rem; }
  label { display: block; font-size: 0.82rem; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: #ccc; margin-bottom: 0.5rem; }
  label .num { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; background: var(--red); color: #fff; font-size: 0.65rem; border-radius: 3px; margin-right: 0.5rem; font-family: 'Orbitron', monospace; }
  input[type="text"], textarea, select {
    width: 100%; background: var(--bg3); border: 1px solid rgba(230,57,70,0.25);
    border-radius: 5px; padding: 0.8rem 1rem; color: var(--text);
    font-family: 'Rajdhani', sans-serif; font-size: 1rem; font-weight: 400;
    transition: border-color 0.2s, box-shadow 0.2s; outline: none; resize: vertical;
  }
  input:focus, textarea:focus, select:focus { border-color: var(--red); box-shadow: 0 0 0 3px var(--red-glow); }
  textarea { min-height: 90px; }
  .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .form-footer { margin-top: 2.5rem; display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap; }
  .form-note { font-size: 0.82rem; color: var(--muted); font-weight: 300; }
  .btn-submit {
    font-family: 'Orbitron', monospace; font-size: 0.75rem; font-weight: 700;
    letter-spacing: 2px; text-transform: uppercase; color: #fff; background: var(--red);
    border: none; padding: 0.9rem 2.2rem; border-radius: 5px; cursor: pointer;
    position: relative; overflow: hidden; transition: transform 0.15s, box-shadow 0.2s;
  }
  .btn-submit:hover { transform: translateY(-1px); box-shadow: 0 6px 24px var(--red-glow); }
  .btn-submit:active { transform: translateY(0); }
  .btn-submit.loading { pointer-events: none; opacity: 0.7; }
  .toast {
    position: fixed; bottom: 2rem; right: 2rem; z-index: 999;
    background: var(--bg2); border: 1px solid var(--border); border-radius: 8px;
    padding: 1rem 1.5rem; display: flex; align-items: center; gap: 0.8rem;
    transform: translateY(100px); opacity: 0; transition: all 0.35s ease;
    max-width: 340px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  }
  .toast.show { transform: translateY(0); opacity: 1; }
  .toast-icon { font-size: 1.4rem; flex-shrink: 0; }
  .toast-title { font-family: 'Orbitron', monospace; font-size: 0.75rem; letter-spacing: 1px; margin-bottom: 2px; }
  .toast-msg { font-size: 0.85rem; color: var(--muted); font-weight: 300; }
  .toast.success { border-color: rgba(52,199,89,0.4); }
  .toast.success .toast-title { color: #34c759; }
  .toast.error { border-color: rgba(230,57,70,0.5); }
  .toast.error .toast-title { color: var(--red); }
  @media (max-width: 640px) {
    .info-grid, .row-2 { grid-template-columns: 1fr; }
    .form-footer { flex-direction: column; align-items: stretch; }
    .btn-submit { text-align: center; }
    .form-card { padding: 1.5rem; }
  }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ PANTALLA DE LOGIN ‚îÄ‚îÄ -->
<div id="login-screen">
  <div class="login-card">
    <div class="login-icon">‚öîÔ∏è</div>
    <h2>Mine<span>Back</span></h2>
    <p>Inicia sesi√≥n con tu cuenta de Discord para poder enviar tu postulaci√≥n al Staff.</p>
    <a href="/login" class="btn-discord">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/>
      </svg>
      Iniciar sesi√≥n con Discord
    </a>
  </div>
</div>

<!-- ‚îÄ‚îÄ CONTENIDO PRINCIPAL ‚îÄ‚îÄ -->
<div id="main-content">
  <nav>
    <div class="nav-logo">Mine<span>Back</span></div>
    <div class="nav-right">
      <div class="nav-breadcrumb"><a href="#">Inicio</a> / Postulaciones Staff</div>
      <div class="nav-user" id="nav-user"></div>
    </div>
  </nav>

  <main>
    <div class="hero">
      <div class="hero-badge">‚ö° Reclutamiento Activo</div>
      <h1>Postulaciones para<br><span>Staff MineBack</span></h1>
      <p class="hero-sub">¬øTienes lo que se necesita? Completa el formulario con honestidad y detalle. Cada respuesta cuenta.</p>
    </div>

    <div class="info-grid">
      <div class="info-card">
        <h3>üìã Requisitos</h3>
        <ul>
          <li>M√≠nimo 14 a√±os de edad</li>
          <li>Cuenta premium</li>
          <li>Historial limpio en el servidor</li>
          <li>No ser staff en otro servidor</li>
          <li>Buena ortograf√≠a y madurez</li>
        </ul>
      </div>
      <div class="info-card">
        <h3>‚ö†Ô∏è Importante</h3>
        <ul>
          <li>Responde con seriedad y honestidad</li>
          <li>Informaci√≥n falsa = descalificaci√≥n</li>
          <li>Revisi√≥n en varios d√≠as</li>
          <li>Resultado enviado por Discord</li>
          <li>Una sola postulaci√≥n por usuario</li>
        </ul>
      </div>
    </div>

    <div class="divider"><span>Formulario de Postulaci√≥n</span></div>

    <div class="form-card">
      <div class="form-header">
        <h2>Completa todos los campos</h2>
        <p>Cada respuesta es le√≠da cuidadosamente por el equipo. S√© claro y detallado.</p>
      </div>

      <form id="postulacion-form">
        <div class="row-2">
          <div class="field-group">
            <label><span class="num">1</span> Tu usuario de Discord</label>
            <input type="text" name="discord" id="campo-discord" placeholder="tuusuario" required maxlength="50">
          </div>
          <div class="field-group">
            <label><span class="num">2</span> Edad y fecha de nacimiento</label>
            <input type="text" name="edad" placeholder="Ej: 16 a√±os ‚Äì 03/05/2008" required>
          </div>
        </div>
        <div class="field-group">
          <label><span class="num">3</span> ¬øPor qu√© quieres ser staff en MineBack?</label>
          <textarea name="razon" placeholder="Explica tus motivaciones con detalle..." required></textarea>
        </div>
        <div class="field-group">
          <label><span class="num">4</span> ¬øQu√© experiencia tienes como staff?</label>
          <textarea name="experiencia" placeholder="Menciona servidores, cargos y tiempo (o 'Sin experiencia previa')..." required></textarea>
        </div>
        <div class="row-2">
          <div class="field-group">
            <label><span class="num">5</span> Horas disponibles por d√≠a</label>
            <input type="text" name="horas" placeholder="Ej: 3-4 horas en semana..." required>
          </div>
          <div class="field-group">
            <label><span class="num">6</span> ¬øConoces comandos de moderaci√≥n?</label>
            <select name="comandos" required>
              <option value="" disabled selected>Selecciona...</option>
              <option value="S√≠, tengo experiencia s√≥lida">‚úÖ S√≠, tengo experiencia s√≥lida</option>
              <option value="Conozco lo b√°sico">‚ö° Conozco lo b√°sico</option>
              <option value="No, pero puedo aprender">üìñ No, pero puedo aprender</option>
            </select>
          </div>
        </div>
        <div class="field-group">
          <label><span class="num">7</span> ¬øC√≥mo manejar√≠as un conflicto entre jugadores?</label>
          <textarea name="conflicto" placeholder="Describe el proceso paso a paso..." required></textarea>
        </div>
        <div class="field-group">
          <label><span class="num">8</span> ¬øQu√© har√≠as si descubres a un jugador usando hacks?</label>
          <textarea name="hacks" placeholder="Explica tu protocolo de acci√≥n..." required></textarea>
        </div>
        <div class="field-group">
          <label><span class="num">+</span> ¬øAlgo m√°s que quieras agregar? (opcional)</label>
          <textarea name="extra" placeholder="Cualquier informaci√≥n adicional relevante..." rows="3"></textarea>
        </div>
        <div class="form-footer">
          <p class="form-note">Al enviar confirmas que toda la informaci√≥n es ver√≠dica.</p>
          <button type="submit" class="btn-submit" id="submit-btn">Enviar Postulaci√≥n ‚Üí</button>
        </div>
      </form>
    </div>
  </main>
</div>

<div class="toast" id="toast">
  <div class="toast-icon" id="toast-icon">‚úÖ</div>
  <div>
    <div class="toast-title" id="toast-title">Postulaci√≥n enviada</div>
    <div class="toast-msg" id="toast-msg">Tu postulaci√≥n lleg√≥ correctamente.</div>
  </div>
</div>

<script>
  // ‚îÄ‚îÄ VERIFICAR LOGIN AL CARGAR ‚îÄ‚îÄ
  async function verificarLogin() {
    try {
      const res = await fetch('/me');
      const user = await res.json();

      if (user.logged) {
        // Ocultar pantalla de login, mostrar contenido
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';

        // Rellenar campo de discord autom√°ticamente
        const campoDc = document.getElementById('campo-discord');
        if (campoDc) campoDc.value = user.username;

        // Mostrar usuario en nav
        const navUser = document.getElementById('nav-user');
        const avatarHtml = user.avatar_url
          ? `<img src="${user.avatar_url}" class="nav-avatar" alt="avatar">`
          : `<div class="nav-avatar-placeholder">${user.username.charAt(0).toUpperCase()}</div>`;
        navUser.innerHTML = `
          ${avatarHtml}
          <span>${user.global_name || user.username}</span>
          <button class="btn-logout" onclick="logout()">Salir</button>
        `;
      } else {
        // Mostrar pantalla de login
        document.getElementById('login-screen').style.display = 'flex';
        document.getElementById('main-content').style.display = 'none';
      }
    } catch (e) {
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('main-content').style.display = 'none';
    }
  }

  function logout() {
    window.location.href = '/logout';
  }

  verificarLogin();

  // ‚îÄ‚îÄ FORMULARIO ‚îÄ‚îÄ
  const form  = document.getElementById("postulacion-form");
  const btn   = document.getElementById("submit-btn");
  const toast = document.getElementById("toast");

  function showToast(type, title, msg) {
    toast.className = `toast ${type}`;
    document.getElementById("toast-icon").textContent = type === "success" ? "‚úÖ" : "‚ùå";
    document.getElementById("toast-title").textContent = title;
    document.getElementById("toast-msg").textContent   = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 5000);
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form));

    btn.classList.add("loading");
    btn.textContent = "Enviando...";

    try {
      const res = await fetch("/enviar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const json = await res.json();

      if (json.ok) {
        showToast("success", "¬°Postulaci√≥n enviada!", "El equipo de MineBack revisar√° tu solicitud pronto.");
        form.reset();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        throw new Error(json.error || "Error desconocido");
      }
    } catch (err) {
      showToast("error", "Error al enviar", "No se pudo enviar. Aseg√∫rate de que el bot est√° activo.");
    }

    btn.classList.remove("loading");
    btn.textContent = "Enviar Postulaci√≥n ‚Üí";
  });
</script>
</body>
</html>
